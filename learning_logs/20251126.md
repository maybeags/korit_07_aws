# 입실 체크 해주세요 !! 💌
# 팀장님들 인원 파악 해주세요 !!
# 첫 시간 복습 내용
1. EC2 생성(CLI까지 들어갈 필요 없습니다)
  - 관련 보안 규칙(HTTPS까지)
2. 탄력적 IP 생성 및 연결
3. RDS 서비스에서 DB 생성
  - 관련 보안 규칙 생성

복습 관련으로 db와 보안 규칙 설정까지 했습니다.
DBeaver 설치도 했습니다.

## RDS parameter group 적용
DB 생성이 끝나고 나서 좌측의 `파라미터 그룹`창으로 들어가서 우측 상단의 `파라미터 그룹 생성` 버튼 클릭

instagram-db-parameter-group 이름 짓고, MySQL Community로 설정하고 생성

생성한 파라미터 그룹 id 클릭하고 편집 들어갑니다.

character_set_client
character_set_connection
character_set_database
character_set_filesystem
character_set_results
character_set_server
의 paramter를 `utf8mb4`로 맞출겁니다.

참고사항 : utf8이 아니라 utf8mb4를 사용하는 이유는 '한글'뿐만 아니라 '이모지'도 지원이 가능하도록 하기 위함.

collation_connection
collation_server
이상의 parameter를 utf8mb4_unicode_ci 로 설정
utf8mb4_unicode_ci 얘는 utf8mb4에 정렬, 비교 방식 추가입니다.

time_zone의 속성을 Asia/Seoul로 수정

## 현재 상황에서 연결과정은 수업 시간에 했습니다. 팀원들 및 강사에게 질문해주세요.

# S3로 이미지 저장소 만들기
## S3
- 한 마디로 요약하자면 파일 저장 서비스.
- 폰 내에 저장 용량이 있음에도 불구하고 왜 아이클라우드나 구글드라이브 등을 쓰는가를 생각해보시면 필요 이유를 알 수 있습니다.

- 업로드된 이미지 파일은 백엔드 서버가 실행되는 EC2 인스턴스 내부에 저장하는 것도 가능하지만, 서비스를 운영하는 과정에서 파일 개수가 많아지면 관리가 어려워질 수 있습니다. 파일을 저장할 공간이 한정되어있고, 인스턴스에 이상이 생기는 경우 데이터가 손실될 위험이 있기 때문에.

- S3는 파일 용량에 제한이 없고 필요에 따라 자동으로 확장됩니다. 또한 데이터를 여러 물리적 위치에 분산하여 저장하기 때문에 데이터가 손실될 확률이 0.000000001%로 아주 희박하기 때문에 실무에 사용됨.

### 버킷
- 구글 드라이브에서 공유 드라이브를 여러 개 만들 수 있는 것처럼 S3에서도 저장소를 여러 개 만드는 것이 가능합니다.

### 객체
- 버킷에 업로드한 파일을 객체(Object)라고 표현합니다. 이 객체는 키-값(key-value) 쌍으로 이루어지는데, key는 객체에 할당한 이름, value는 업로드한 컨텐츠 자체를 의미함. 객체의 값은 byte 형태로 저장됨.

## S3를 이용한 아키텍쳐 구성
1. 이미지 업로드 과정
![alt text](image-25.png)

2. 이미지 다운로드 과정
![alt text](image-26.png)

- 참고 : 편의상 이미지라고 했지만 video 및 pdf 등의 다양한 형식의 파일 전체를 포괄합니다.

## 버킷 생성
콘솔 홈에서 S3 검색 -> `버킷 생성` 버튼 클릭

`instagram-static-files880709`으로 임의로 이름 지었습니다. 여러분들도 나름대로 이름 붙일 것.

![alt text](image-27.png)
퍼블릭 액세스 차단을 비활성화 하고, 경고 문구에 체크를 합니다.

## 버킷 사용을 위한 정책 설정하기.
- AWS에서 자원을 생성하면 기본적으로 모든 권한이 차단되어 있는데, 예를 들어 S3 버킷을 만든 뒤에 이미지를 업로드 하려고 해도, 별도 권한을 설정하지 않으면 이 이미지에 접근하는 것이 불가능합니다.

- 이 때, 우리는 `정책(Policy)`을 통해서 그 `권한(Permission)`을 설정할 수 있습니다.

- 정책 : _권한을 정의하는 `JSON` 문서_ 
  - 특정 서비스에서 상품 이미지를 _모든_ 사용자에게 보여주고 싶다면? 혹은 _특정_ 회원에게만 이미지, 비디오클립을 공유하고 싶다면? 에 해당하는 부분입니다.

  - 실습에서는 이미지 파일을 조회할 수 있도록 정책을 추가해보겠습니다.

  - 정책 편집에서 GetObject 이후 `리소스 추가` 선택
  ![alt text](image-28.png)

  - 최종 결과
```json
{
	"Version": "2012-10-17",
	"Statement": [
		{
			"Sid": "Statement1",
			"Principal": "*",
			"Effect": "Allow",
			"Action": [
				"s3:GetObject"
			],
			"Resource": [
				"arn:aws:s3:::instagram-static-files880709/*"
			]
		}
	]
}
```

## S3에 파일 업로드가 가능하도록 IAM에서 액세스 키 발급 받기